<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 820" font-family="'Segoe UI', system-ui, -apple-system, sans-serif">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
    </marker>
    <marker id="arrow-red" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#dc2626"/>
    </marker>
    <marker id="arrow-blue" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2563eb"/>
    </marker>
    <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#16a34a"/>
    </marker>
    <filter id="shadow" x="-4%" y="-4%" width="108%" height="108%">
      <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.1"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="900" height="820" rx="12" fill="#f8fafc"/>

  <!-- Title -->
  <text x="450" y="40" text-anchor="middle" font-size="20" font-weight="700" fill="#0f172a">SDK Research Flow (Mimics CLI)</text>
  <text x="450" y="60" text-anchor="middle" font-size="12" fill="#94a3b8">claude-agent-sdk/agent.py &#8594; loads .claude-resources/commands/workflow-research-sdk.md</text>

  <!-- User triggers endpoint -->
  <rect x="255" y="80" width="390" height="50" rx="25" fill="#2563eb" filter="url(#shadow)"/>
  <text x="450" y="110" text-anchor="middle" font-size="14" font-weight="600" fill="#fff">POST /research-claude-agent-sdk</text>

  <!-- Arrow -->
  <line x1="450" y1="130" x2="450" y2="165" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- agent.py: Load problem + command -->
  <g filter="url(#shadow)">
    <rect x="150" y="170" width="600" height="70" rx="8" fill="#fff" stroke="#e2e8f0" stroke-width="1.5"/>
    <rect x="150" y="170" width="600" height="26" rx="8" fill="#eff6ff"/>
    <rect x="150" y="188" width="600" height="8" fill="#eff6ff"/>
    <text x="170" y="188" font-size="11" font-weight="700" fill="#2563eb">agent.py — LOAD PROBLEM &amp; WORKFLOW COMMAND</text>
    <text x="450" y="213" text-anchor="middle" font-size="13" fill="#334155">load_problem() &#8594; problem-statement.json { game, start_year, end_year }</text>
    <text x="450" y="230" text-anchor="middle" font-size="11" fill="#94a3b8">load_workflow_command() &#8594; .claude-resources/commands/workflow-research-sdk.md</text>
  </g>

  <!-- Arrow -->
  <line x1="450" y1="240" x2="450" y2="275" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 1: Spawn Reddit Research Agent via Task tool -->
  <g filter="url(#shadow)">
    <rect x="200" y="280" width="500" height="55" rx="8" fill="#dc2626"/>
    <text x="450" y="301" text-anchor="middle" font-size="11" font-weight="700" fill="#fecaca">STEP 1 — SPAWN SUBAGENT VIA TASK TOOL</text>
    <text x="450" y="319" text-anchor="middle" font-size="12" fill="#fff">Task(subagent_type: reddit-game-research-agent)</text>
  </g>

  <!-- Arrow to agent box -->
  <line x1="450" y1="335" x2="450" y2="365" stroke="#dc2626" stroke-width="2" marker-end="url(#arrow-red)"/>

  <!-- Agent box -->
  <rect x="80" y="370" width="740" height="145" rx="10" fill="#fef2f2" stroke="#fca5a5" stroke-width="1.5" stroke-dasharray="6 3" filter="url(#shadow)"/>
  <text x="100" y="393" font-size="11" font-weight="700" fill="#dc2626">SUBAGENT: AgentDefinition (prompt from .claude/agents/reddit-game-research-agent.md)</text>

  <g filter="url(#shadow)">
    <rect x="100" y="405" width="200" height="80" rx="8" fill="#fff" stroke="#fca5a5" stroke-width="1"/>
    <text x="200" y="428" text-anchor="middle" font-size="12" font-weight="600" fill="#dc2626">Search Reddit</text>
    <text x="200" y="446" text-anchor="middle" font-size="10" fill="#64748b">via Reddit MCP Server</text>
    <text x="200" y="462" text-anchor="middle" font-size="10" fill="#64748b">Find every game title</text>
    <text x="200" y="478" text-anchor="middle" font-size="10" fill="#64748b">Find copies sold per title</text>
  </g>

  <line x1="300" y1="445" x2="340" y2="445" stroke="#dc2626" stroke-width="1.5" marker-end="url(#arrow-red)"/>

  <g filter="url(#shadow)">
    <rect x="345" y="405" width="195" height="80" rx="8" fill="#fff" stroke="#fca5a5" stroke-width="1"/>
    <text x="442" y="428" text-anchor="middle" font-size="11" font-weight="600" fill="#dc2626">Tools Available</text>
    <text x="442" y="446" text-anchor="middle" font-size="10" fill="#64748b">Read, Write</text>
    <text x="442" y="462" text-anchor="middle" font-size="10" fill="#64748b">mcp__reddit-mcp-server__*</text>
    <text x="442" y="478" text-anchor="middle" font-size="10" fill="#94a3b8">(search, browse, get_post)</text>
  </g>

  <line x1="540" y1="445" x2="575" y2="445" stroke="#dc2626" stroke-width="1.5" marker-end="url(#arrow-red)"/>

  <g filter="url(#shadow)">
    <rect x="580" y="410" width="220" height="70" rx="8" fill="#fff3cd" stroke="#ffc107" stroke-width="1"/>
    <text x="690" y="433" text-anchor="middle" font-size="11" font-weight="600" fill="#856404">reddit-data-{n}.md</text>
    <text x="690" y="451" text-anchor="middle" font-size="10" fill="#856404">Raw Reddit posts, queries,</text>
    <text x="690" y="467" text-anchor="middle" font-size="10" fill="#856404">per-game copy sales from Reddit</text>
  </g>

  <!-- Arrow from agent to Step 2 -->
  <line x1="450" y1="515" x2="450" y2="548" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 2: Synthesize Report -->
  <g filter="url(#shadow)">
    <rect x="100" y="553" width="700" height="120" rx="10" fill="#f0f9ff" stroke="#7dd3fc" stroke-width="1.5"/>
    <rect x="100" y="553" width="700" height="26" rx="10" fill="#e0f2fe"/>
    <rect x="100" y="571" width="700" height="8" fill="#e0f2fe"/>
    <text x="120" y="571" font-size="11" font-weight="700" fill="#0369a1">STEP 2 — SYNTHESIZE RESEARCH REPORT</text>
    <text x="450" y="598" text-anchor="middle" font-size="12" fill="#0c4a6e">Read reddit-data-{n}.md &#8594; Build revenue table + JSON data block</text>
    <text x="450" y="616" text-anchor="middle" font-size="11" fill="#64748b">Revenue = copies sold x retail price (no microtransactions, DLC, or in-app)</text>
  </g>

  <g filter="url(#shadow)">
    <rect x="300" y="635" width="300" height="28" rx="8" fill="#fff3cd" stroke="#ffc107" stroke-width="1"/>
    <text x="450" y="654" text-anchor="middle" font-size="11" font-weight="600" fill="#856404">research-{n}.md (revenue table + JSON)</text>
  </g>

  <!-- Arrow to Step 3 -->
  <line x1="450" y1="663" x2="450" y2="698" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 3: Report -->
  <g filter="url(#shadow)">
    <rect x="250" y="703" width="400" height="50" rx="8" fill="#f0fdf4" stroke="#86efac" stroke-width="1.5"/>
    <text x="450" y="724" text-anchor="middle" font-size="11" font-weight="700" fill="#16a34a">STEP 3 — REPORT</text>
    <text x="450" y="742" text-anchor="middle" font-size="12" fill="#166534">Verify both output files exist</text>
  </g>

  <!-- Arrow to done -->
  <line x1="450" y1="753" x2="450" y2="778" stroke="#16a34a" stroke-width="2" marker-end="url(#arrow-green)"/>

  <!-- Done -->
  <rect x="320" y="783" width="260" height="30" rx="15" fill="#16a34a" filter="url(#shadow)"/>
  <text x="450" y="803" text-anchor="middle" font-size="12" font-weight="600" fill="#fff">SDK_RESEARCH_COMPLETE</text>
</svg>
