<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 720" font-family="'Segoe UI', system-ui, -apple-system, sans-serif">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
    </marker>
    <marker id="arrow-red" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#dc2626"/>
    </marker>
    <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#16a34a"/>
    </marker>
    <filter id="shadow" x="-4%" y="-4%" width="108%" height="108%">
      <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.1"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="900" height="720" rx="12" fill="#f8fafc"/>

  <!-- Title -->
  <text x="450" y="40" text-anchor="middle" font-size="20" font-weight="700" fill="#0f172a">/research-claude-code-cli — Workflow</text>

  <!-- Step 1: User invokes command -->
  <rect x="300" y="65" width="300" height="50" rx="25" fill="#1e293b" filter="url(#shadow)"/>
  <text x="450" y="95" text-anchor="middle" font-size="14" font-weight="600" fill="#fff">User invokes /research-claude-code-cli</text>

  <!-- Arrow 1→2 -->
  <line x1="450" y1="115" x2="450" y2="145" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 2: Read Problem + State (side by side) -->
  <g filter="url(#shadow)">
    <rect x="80" y="150" width="320" height="70" rx="8" fill="#fff" stroke="#e2e8f0" stroke-width="1.5"/>
    <rect x="80" y="150" width="320" height="28" rx="8" fill="#f1f5f9"/>
    <rect x="80" y="170" width="320" height="8" fill="#f1f5f9"/>
    <text x="100" y="170" font-size="11" font-weight="700" fill="#475569">STEP 1</text>
    <text x="240" y="195" text-anchor="middle" font-size="13" fill="#334155">Read problem-statement.json</text>
    <text x="240" y="212" text-anchor="middle" font-size="11" fill="#94a3b8">{ game, start_year, end_year }</text>
  </g>

  <g filter="url(#shadow)">
    <rect x="500" y="150" width="320" height="70" rx="8" fill="#fff" stroke="#e2e8f0" stroke-width="1.5"/>
    <rect x="500" y="150" width="320" height="28" rx="8" fill="#f1f5f9"/>
    <rect x="500" y="170" width="320" height="8" fill="#f1f5f9"/>
    <text x="520" y="170" font-size="11" font-weight="700" fill="#475569">STEP 1</text>
    <text x="660" y="195" text-anchor="middle" font-size="13" fill="#334155">Read workflow-state.yaml</text>
    <text x="660" y="212" text-anchor="middle" font-size="11" fill="#94a3b8">Determine iteration number</text>
  </g>

  <!-- Arrows from step 2 to step 3 -->
  <line x1="240" y1="220" x2="240" y2="250" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="660" y1="220" x2="660" y2="250" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="240" y1="260" x2="450" y2="280" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="660" y1="260" x2="450" y2="280" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 3: Spawn Research Agent -->
  <g filter="url(#shadow)">
    <rect x="200" y="280" width="500" height="55" rx="8" fill="#dc2626" />
    <text x="450" y="303" text-anchor="middle" font-size="11" font-weight="700" fill="#fecaca">STEP 2 — SPAWN SUBAGENT</text>
    <text x="450" y="323" text-anchor="middle" font-size="14" font-weight="600" fill="#fff">Games Revenue Researcher Agent</text>
  </g>

  <!-- Arrow to agent internals -->
  <line x1="450" y1="335" x2="450" y2="365" stroke="#dc2626" stroke-width="2" marker-end="url(#arrow-red)"/>

  <!-- Agent box (big) -->
  <rect x="60" y="370" width="780" height="210" rx="10" fill="#fef2f2" stroke="#fca5a5" stroke-width="1.5" stroke-dasharray="6 3" filter="url(#shadow)"/>
  <text x="80" y="393" font-size="11" font-weight="700" fill="#dc2626">INSIDE THE RESEARCH AGENT</text>

  <!-- Sub-step A: Search Reddit -->
  <g filter="url(#shadow)">
    <rect x="90" y="405" width="230" height="80" rx="8" fill="#fff" stroke="#fca5a5" stroke-width="1"/>
    <text x="205" y="428" text-anchor="middle" font-size="12" font-weight="600" fill="#dc2626">Search Reddit (MCP)</text>
    <text x="205" y="446" text-anchor="middle" font-size="10" fill="#64748b">r/FIFA, r/EASportsFC, r/gaming</text>
    <text x="205" y="460" text-anchor="middle" font-size="10" fill="#64748b">r/Games, r/truegaming, r/pcgaming</text>
    <text x="205" y="474" text-anchor="middle" font-size="10" fill="#64748b">Find every title + revenue data</text>
  </g>

  <!-- Arrow A→B -->
  <line x1="320" y1="445" x2="350" y2="445" stroke="#dc2626" stroke-width="1.5" marker-end="url(#arrow-red)"/>

  <!-- Sub-step B: Build revenue map -->
  <g filter="url(#shadow)">
    <rect x="355" y="405" width="220" height="80" rx="8" fill="#fff" stroke="#fca5a5" stroke-width="1"/>
    <text x="465" y="428" text-anchor="middle" font-size="12" font-weight="600" fill="#dc2626">Map Revenue</text>
    <text x="465" y="446" text-anchor="middle" font-size="10" fill="#64748b">Base sales + microtransactions</text>
    <text x="465" y="460" text-anchor="middle" font-size="10" fill="#64748b">DLC + Ultimate Team + mobile</text>
    <text x="465" y="474" text-anchor="middle" font-size="10" fill="#64748b">Estimate where data is sparse</text>
  </g>

  <!-- Arrow B→C -->
  <line x1="575" y1="445" x2="605" y2="445" stroke="#dc2626" stroke-width="1.5" marker-end="url(#arrow-red)"/>

  <!-- Sub-step C: Calculate total -->
  <g filter="url(#shadow)">
    <rect x="610" y="405" width="200" height="80" rx="8" fill="#fff" stroke="#fca5a5" stroke-width="1"/>
    <text x="710" y="428" text-anchor="middle" font-size="12" font-weight="600" fill="#dc2626">Calculate Total</text>
    <text x="710" y="446" text-anchor="middle" font-size="10" fill="#64748b">Sum all title revenues</text>
    <text x="710" y="460" text-anchor="middle" font-size="10" fill="#64748b">Grand total franchise revenue</text>
    <text x="710" y="474" text-anchor="middle" font-size="10" fill="#64748b">Assign confidence levels</text>
  </g>

  <!-- Write outputs -->
  <g filter="url(#shadow)">
    <rect x="165" y="500" width="260" height="50" rx="8" fill="#fff3cd" stroke="#ffc107" stroke-width="1"/>
    <text x="295" y="520" text-anchor="middle" font-size="11" font-weight="600" fill="#856404">reddit-data-{n}.md</text>
    <text x="295" y="536" text-anchor="middle" font-size="10" fill="#856404">Raw Reddit posts + search queries</text>
  </g>

  <g filter="url(#shadow)">
    <rect x="475" y="500" width="260" height="50" rx="8" fill="#fff3cd" stroke="#ffc107" stroke-width="1"/>
    <text x="605" y="520" text-anchor="middle" font-size="11" font-weight="600" fill="#856404">research-{n}.md</text>
    <text x="605" y="536" text-anchor="middle" font-size="10" fill="#856404">Revenue table + JSON data block</text>
  </g>

  <!-- Arrows from calculate to outputs -->
  <line x1="350" y1="485" x2="295" y2="498" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow)"/>
  <line x1="560" y1="485" x2="605" y2="498" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Arrow from agent box to commit -->
  <line x1="450" y1="580" x2="450" y2="610" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Step 4: Git Commit -->
  <g filter="url(#shadow)">
    <rect x="250" y="615" width="400" height="50" rx="8" fill="#f0fdf4" stroke="#86efac" stroke-width="1.5"/>
    <text x="450" y="636" text-anchor="middle" font-size="11" font-weight="700" fill="#16a34a">STEP 3 — GIT COMMIT</text>
    <text x="450" y="654" text-anchor="middle" font-size="12" fill="#166534">cli-research({n}): CLI agent research complete (ground truth)</text>
  </g>

  <!-- Arrow to done -->
  <line x1="450" y1="665" x2="450" y2="690" stroke="#16a34a" stroke-width="2" marker-end="url(#arrow-green)"/>

  <!-- Done -->
  <rect x="330" y="690" width="240" height="30" rx="15" fill="#16a34a" filter="url(#shadow)"/>
  <text x="450" y="710" text-anchor="middle" font-size="12" font-weight="600" fill="#fff">CLI_RESEARCH_COMPLETE</text>
</svg>
